<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@300;400;500;600;700;800;900&display=swap');
        body { 
            font-family: 'Noto Sans Devanagari', sans-serif; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #6366f1, #8b5cf6);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(to bottom, #4f46e5, #7c3aed);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .entry-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        .entry-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        @media print {
            .no-print { display: none !important; }
            .print-area { box-shadow: none !important; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen" id="appBody">
    <!-- Header -->
    <div class="bg-white/95 backdrop-blur-md shadow-lg border-b border-white/20 no-print sticky top-0 z-40">
        <div class="w-full px-3 py-2">
            <div class="flex justify-between items-center">
                <h1 class="text-lg font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent cursor-pointer select-none transition-all duration-300 hover:scale-105" id="appTitle" ontouchstart="startLongPress()" ontouchend="endLongPress()" onmousedown="startLongPress()" onmouseup="endLongPress()" onmouseleave="endLongPress()">üìã <span id="appName">Bill Creator</span></h1>
                <div class="flex gap-1">
                    <button onclick="showHistory()" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white p-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 text-sm" title="History">
                        üìö
                    </button>
                    <button onclick="clearBill()" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white p-2 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 text-sm" title="Clear">
                        üóëÔ∏è
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="w-full p-1">
        <!-- Bill Form -->
        <div class="bg-white/95 backdrop-blur-sm rounded-xl shadow-xl border border-white/20 p-3 mb-2 print-area" id="billArea">
            <!-- Bill Header -->
            <div class="mb-4 border-b border-gray-200 pb-3">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-bold bg-gradient-to-r from-gray-800 to-gray-600 bg-clip-text text-transparent" id="shopName" oncontextmenu="editShopName(event)">‡§¨‡§ø‡§≤ / BILL</h2>
                    <div class="relative no-print">
                        <button onclick="toggleBillMenu()" class="bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 p-1.5 rounded-lg transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 text-sm">
                            ‚ãÆ
                        </button>
                        <div id="billMenu" class="hidden absolute right-0 top-10 bg-white/95 backdrop-blur-md shadow-xl rounded-xl border border-white/20 z-10 w-40 overflow-hidden">
                            <button onclick="printBill()" class="w-full text-left px-3 py-2 hover:bg-gradient-to-r hover:from-blue-50 hover:to-blue-100 flex items-center gap-2 transition-all duration-200 text-sm">
                                üñ®Ô∏è Print
                            </button>
                            <button onclick="saveBill()" class="w-full text-left px-3 py-2 hover:bg-gradient-to-r hover:from-green-50 hover:to-green-100 flex items-center gap-2 transition-all duration-200 text-sm">
                                üíæ Save
                            </button>
                            <button onclick="shareBill()" class="w-full text-left px-3 py-2 hover:bg-gradient-to-r hover:from-purple-50 hover:to-purple-100 flex items-center gap-2 transition-all duration-200 text-sm">
                                üì§ Share
                            </button>
                            <button onclick="downloadImage()" class="w-full text-left px-3 py-2 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-indigo-100 flex items-center gap-2 transition-all duration-200 text-sm">
                                üì∑ Image
                            </button>
                            <button onclick="sendNotice()" class="w-full text-left px-3 py-2 hover:bg-gradient-to-r hover:from-orange-50 hover:to-orange-100 flex items-center gap-2 transition-all duration-200 text-sm">
                                üì¢ Notice
                            </button>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between text-xs font-medium text-gray-600 bg-gray-50 rounded-lg px-2 py-1.5">
                    <span>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: <span id="currentDate" class="font-semibold"></span></span>
                    <span>‡§¶‡§ø‡§®: <span id="dayName" class="font-semibold text-indigo-600"></span></span>
                </div>
            </div>

            <!-- Entries List -->
            <div class="mb-20">
                <div id="entriesList" class="space-y-1.5 max-h-64 overflow-y-auto custom-scrollbar">
                    <!-- Entries will be added here -->
                </div>
                
                <!-- Total Section -->
                <div class="border-t border-gray-200 pt-3 mt-4">
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-3">
                        <div class="text-left">
                            <div class="text-sm font-semibold text-gray-700 mb-1">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                            <div class="text-2xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent" id="totalAmount">‚Çπ 0.00</div>
                        </div>
                    </div>
                </div>
            </div>


        </div>


    </div>

    <!-- Fixed Bottom Input Form -->
    <div class="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-md shadow-xl border-t border-white/20 no-print">
        <div class="w-full p-2">
            <div class="flex gap-2 items-center">
                <div class="w-24">
                    <input type="number" id="amount" placeholder="‚Çπ" min="0" step="1"
                           class="w-full px-2 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-left text-base font-semibold shadow-md transition-all duration-200 hover:shadow-lg">
                </div>
                <div class="flex-1">
                    <input type="text" id="itemDescription" placeholder="‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ..." 
                           class="w-full px-3 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 text-base shadow-md transition-all duration-200 hover:shadow-lg">
                </div>
                <button onclick="addEntry()" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-4 py-3 rounded-lg font-semibold transition-all duration-200 shadow-md hover:shadow-lg transform hover:scale-105 active:scale-95">
                    ‚ûï
                </button>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800">üìö Saved Bills History</h3>
                        <button onclick="closeHistory()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto max-h-80" id="historyList">
                    <!-- History items will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bill Details Modal -->
    <div id="billDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-96 overflow-hidden">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold text-gray-800" id="billDetailsTitle">Bill Details</h3>
                        <button onclick="closeBillDetails()" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
                    </div>
                </div>
                <div class="p-6 overflow-y-auto max-h-80" id="billDetailsContent">
                    <!-- Bill details will be loaded here -->
                </div>
                <div class="p-6 border-t">
                    <div class="flex justify-between items-center">
                        <div></div>
                        <div class="relative">
                            <button onclick="toggleHistoryBillMenu()" class="bg-gray-100 hover:bg-gray-200 p-2 rounded-lg transition-colors">
                                ‚ãÆ
                            </button>
                            <div id="historyBillMenu" class="hidden absolute right-0 bottom-12 bg-white shadow-lg rounded-lg border z-10 w-40">
                                <button onclick="printBillDetails()" class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2">
                                    üñ®Ô∏è Print
                                </button>
                                <button onclick="shareBillDetails()" class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2">
                                    üì§ Share
                                </button>
                                <button onclick="downloadBillDetailsImage()" class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2">
                                    üì∑ Image
                                </button>
                                <button onclick="sendNoticeDetails()" class="w-full text-left px-4 py-2 hover:bg-gray-50 flex items-center gap-2">
                                    üì¢ Send Notice
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
                <div class="p-6 border-b bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-t-xl">
                    <h3 class="text-xl font-bold">‚öôÔ∏è Settings</h3>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">App Name</label>
                        <input type="text" id="newAppName" placeholder="App ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." 
                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Shop Name</label>
                        <input type="text" id="newShopName" placeholder="‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç..." 
                               class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                        <select id="themeSelect" class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="auto">ü§ñ Auto Device</option>
                            <option value="royal">üëë Royal Purple</option>
                            <option value="ocean">üåä Ocean Blue</option>
                            <option value="sunset">üåÖ Sunset Orange</option>
                            <option value="forest">üå≤ Forest Green</option>
                            <option value="midnight">üåô Midnight Black</option>
                            <option value="rose">üåπ Rose Gold</option>
                            <option value="emerald">üíé Emerald Luxury</option>
                            <option value="crimson">üî• Crimson Fire</option>
                            <option value="sapphire">üíô Sapphire Elite</option>
                            <option value="golden">‚ú® Golden Premium</option>
                            <option value="platinum">ü•à Platinum Pro</option>
                            <option value="neon">‚ö° Neon Cyber</option>
                            <option value="arctic">‚ùÑÔ∏è Arctic Ice</option>
                            <option value="volcano">üåã Volcano Red</option>
                            <option value="galaxy">üåå Galaxy Space</option>
                            <option value="mint">üçÉ Fresh Mint</option>
                            <option value="coral">ü™∏ Coral Reef</option>
                            <option value="lavender">üíú Lavender Dream</option>
                            <option value="bronze">ü•â Bronze Classic</option>
                            <option value="diamond">üíé Diamond White</option>
                        </select>
                    </div>
                </div>
                <div class="p-6 border-t flex gap-3 justify-end">
                    <button onclick="closeSettings()" class="px-4 py-2 text-gray-600 hover:text-gray-800 rounded-lg">Cancel</button>
                    <button onclick="saveSettings()" class="bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-6 py-2 rounded-lg font-medium">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Message -->
    <div id="successMessage" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg hidden z-50">
        <span id="successText">‚úÖ Bill saved successfully!</span>
    </div>

    <script>
        let entries = [];
        let entryCounter = 1;
        let billCounter = 1;
        let shopName = '‡§¨‡§ø‡§≤ / BILL';
        let appName = 'Bill Creator';
        let currentTheme = 'auto';
        let longPressTimer = null;
        let isLongPress = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateDate();
            updateDayName();
            loadBillCounter();
            loadShopName();
            loadAppName();
            loadTheme();
            loadCurrentBill(); // Load current bill data
            
            // Close menus when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('#billMenu') && !e.target.closest('button[onclick="toggleBillMenu()"]')) {
                    document.getElementById('billMenu').classList.add('hidden');
                }
                if (!e.target.closest('#historyBillMenu') && !e.target.closest('button[onclick="toggleHistoryBillMenu()"]')) {
                    document.getElementById('historyBillMenu').classList.add('hidden');
                }
            });
        });

        function updateDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('hi-IN');
            document.getElementById('currentDate').textContent = dateStr;
        }

        function updateDayName() {
            const days = ['‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞', '‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞', '‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞', '‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞', '‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞', '‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞', '‡§∂‡§®‡§ø‡§µ‡§æ‡§∞'];
            const today = new Date();
            const dayName = days[today.getDay()];
            document.getElementById('dayName').textContent = dayName;
        }

        function getDayName() {
            const days = ['‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞', '‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞', '‡§Æ‡§Ç‡§ó‡§≤‡§µ‡§æ‡§∞', '‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞', '‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞', '‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞', '‡§∂‡§®‡§ø‡§µ‡§æ‡§∞'];
            const today = new Date();
            return days[today.getDay()];
        }

        function loadBillCounter() {
            const saved = localStorage.getItem('billCounter');
            if (saved) {
                billCounter = parseInt(saved);
                updateBillNumber();
            }
        }

        function loadShopName() {
            const saved = localStorage.getItem('shopName');
            if (saved) {
                shopName = saved;
                document.getElementById('shopName').textContent = shopName;
            }
        }

        function loadAppName() {
            const saved = localStorage.getItem('appName');
            if (saved) {
                appName = saved;
                document.getElementById('appName').textContent = appName;
            }
        }

        function loadTheme() {
            const saved = localStorage.getItem('currentTheme');
            if (saved) {
                currentTheme = saved;
                applyTheme(currentTheme);
            } else {
                applyTheme('auto');
            }
        }

        function loadCurrentBill() {
            const saved = localStorage.getItem('currentBillEntries');
            if (saved) {
                entries = JSON.parse(saved);
                renderEntries();
                updateTotal();
                
                // Load entry counter
                const savedCounter = localStorage.getItem('currentEntryCounter');
                if (savedCounter) {
                    entryCounter = parseInt(savedCounter);
                }
            }
        }

        function saveCurrentBill() {
            localStorage.setItem('currentBillEntries', JSON.stringify(entries));
            localStorage.setItem('currentEntryCounter', entryCounter.toString());
        }

        function startLongPress() {
            isLongPress = false;
            longPressTimer = setTimeout(() => {
                isLongPress = true;
                openSettings();
            }, 800);
        }

        function endLongPress() {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }

        function openSettings() {
            document.getElementById('newAppName').value = appName;
            document.getElementById('newShopName').value = shopName;
            document.getElementById('themeSelect').value = currentTheme;
            document.getElementById('settingsModal').classList.remove('hidden');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function saveSettings() {
            const newAppNameValue = document.getElementById('newAppName').value.trim();
            const newShopNameValue = document.getElementById('newShopName').value.trim();
            const newTheme = document.getElementById('themeSelect').value;

            if (newAppNameValue) {
                appName = newAppNameValue;
                document.getElementById('appName').textContent = appName;
                localStorage.setItem('appName', appName);
            }

            if (newShopNameValue) {
                shopName = newShopNameValue;
                document.getElementById('shopName').textContent = shopName;
                localStorage.setItem('shopName', shopName);
            }

            if (newTheme !== currentTheme) {
                currentTheme = newTheme;
                localStorage.setItem('currentTheme', currentTheme);
                applyTheme(currentTheme);
            }

            closeSettings();
            showSuccess('‚öôÔ∏è Settings saved successfully!');
        }

        function applyTheme(theme) {
            const body = document.getElementById('appBody');
            const themes = {
                auto: () => {
                    const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    if (isDark) {
                        body.className = 'bg-gradient-to-br from-gray-900 to-black min-h-screen text-white';
                    } else {
                        body.className = 'bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen';
                    }
                },
                royal: () => body.className = 'bg-gradient-to-br from-purple-900 to-indigo-900 min-h-screen',
                ocean: () => body.className = 'bg-gradient-to-br from-blue-900 to-cyan-900 min-h-screen',
                sunset: () => body.className = 'bg-gradient-to-br from-orange-400 to-red-600 min-h-screen',
                forest: () => body.className = 'bg-gradient-to-br from-green-800 to-emerald-900 min-h-screen',
                midnight: () => body.className = 'bg-gradient-to-br from-gray-900 to-black min-h-screen',
                rose: () => body.className = 'bg-gradient-to-br from-pink-400 to-rose-600 min-h-screen',
                emerald: () => body.className = 'bg-gradient-to-br from-emerald-600 to-teal-800 min-h-screen',
                crimson: () => body.className = 'bg-gradient-to-br from-red-700 to-red-900 min-h-screen',
                sapphire: () => body.className = 'bg-gradient-to-br from-blue-700 to-indigo-900 min-h-screen',
                golden: () => body.className = 'bg-gradient-to-br from-yellow-400 to-orange-600 min-h-screen',
                platinum: () => body.className = 'bg-gradient-to-br from-gray-400 to-gray-600 min-h-screen',
                neon: () => body.className = 'bg-gradient-to-br from-cyan-400 to-purple-600 min-h-screen',
                arctic: () => body.className = 'bg-gradient-to-br from-blue-100 to-cyan-200 min-h-screen',
                volcano: () => body.className = 'bg-gradient-to-br from-red-600 to-orange-800 min-h-screen',
                galaxy: () => body.className = 'bg-gradient-to-br from-purple-900 to-black min-h-screen',
                mint: () => body.className = 'bg-gradient-to-br from-green-300 to-teal-400 min-h-screen',
                coral: () => body.className = 'bg-gradient-to-br from-pink-300 to-orange-400 min-h-screen',
                lavender: () => body.className = 'bg-gradient-to-br from-purple-300 to-pink-400 min-h-screen',
                bronze: () => body.className = 'bg-gradient-to-br from-yellow-600 to-orange-700 min-h-screen',
                diamond: () => body.className = 'bg-gradient-to-br from-gray-100 to-white min-h-screen'
            };

            if (themes[theme]) {
                themes[theme]();
            }
        }

        function editShopName(event) {
            event.preventDefault();
            openSettings();
        }

        function toggleBillMenu() {
            const menu = document.getElementById('billMenu');
            menu.classList.toggle('hidden');
        }

        function toggleHistoryBillMenu() {
            const menu = document.getElementById('historyBillMenu');
            menu.classList.toggle('hidden');
        }

        function addEntry() {
            const amount = parseInt(document.getElementById('amount').value) || 0;
            const description = document.getElementById('itemDescription').value.trim();

            if (amount <= 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∞‡§æ‡§∂‡§ø ‡§≠‡§∞‡•á‡§Ç!');
                return;
            }

            if (!description) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§æ‡§Æ‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§≤‡§ø‡§ñ‡•á‡§Ç!');
                return;
            }

            const entry = {
                id: entryCounter,
                amount: amount,
                description: description
            };

            entries.push(entry);
            renderEntries();
            updateTotal();
            clearForm();
            entryCounter++;
            saveCurrentBill(); // Save after adding entry
            
            // Auto scroll to latest entry
            setTimeout(() => {
                const entriesList = document.getElementById('entriesList');
                entriesList.scrollTop = entriesList.scrollHeight;
            }, 100);
        }

        function renderEntries() {
            const container = document.getElementById('entriesList');
            container.innerHTML = '';

            entries.forEach((entry, index) => {
                const row = document.createElement('div');
                row.className = 'entry-item flex items-center py-2.5 px-3 rounded-lg shadow-md';
                row.innerHTML = `
                    <div class="w-24 text-right font-bold text-base bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">‚Çπ ${entry.amount}</div>
                    <div class="flex-1 text-left text-base pl-3 font-medium text-gray-800">${entry.description}</div>
                    <button onclick="removeEntry(${index})" class="text-red-500 hover:text-red-700 no-print px-2 py-1 rounded-lg hover:bg-red-50 transition-all duration-200 font-bold text-lg">√ó</button>
                `;
                container.appendChild(row);
            });
        }

        function removeEntry(index) {
            entries.splice(index, 1);
            renderEntries();
            updateTotal();
            saveCurrentBill(); // Save after removing entry
        }

        function updateTotal() {
            const total = entries.reduce((sum, entry) => sum + entry.amount, 0);
            document.getElementById('totalAmount').innerHTML = `<span class="font-light">‚Çπ</span> ${total}`;
        }

        function clearForm() {
            document.getElementById('amount').value = '';
            document.getElementById('itemDescription').value = '';
            document.getElementById('amount').focus();
        }

        function clearBill() {
            if (entries.length === 0) {
                alert('‡§ï‡•ã‡§à entries ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç clear ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è!');
                return;
            }
            
            // Create custom confirmation with shorter timeout
            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center';
            confirmDiv.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-sm mx-4 shadow-2xl">
                    <h3 class="text-lg font-bold mb-3 text-center">‚ö†Ô∏è Confirm Clear</h3>
                    <p class="text-gray-600 mb-4 text-center">‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§∏‡§≠‡•Ä entries ‡§ï‡•ã clear ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?</p>
                    <div class="flex gap-3 justify-center">
                        <button onclick="confirmClear(true)" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg font-medium">Yes</button>
                        <button onclick="confirmClear(false)" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-lg font-medium">No</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);
            
            // Auto close after 3 seconds
            setTimeout(() => {
                if (document.body.contains(confirmDiv)) {
                    document.body.removeChild(confirmDiv);
                }
            }, 3000);
        }

        function confirmClear(confirmed) {
            const confirmDiv = document.querySelector('.fixed.inset-0.bg-black.bg-opacity-50');
            if (confirmDiv) {
                document.body.removeChild(confirmDiv);
            }
            
            if (confirmed) {
                entries = [];
                entryCounter = 1;
                renderEntries();
                updateTotal();
                clearForm();
                localStorage.removeItem('currentBillEntries'); // Clear saved data
                localStorage.removeItem('currentEntryCounter');
                showSuccess('üóëÔ∏è ‡§∏‡§≠‡•Ä entries clear ‡§π‡•ã ‡§ó‡§à‡§Ç!');
            }
        }

        function printBill() {
            const originalContent = document.body.innerHTML;
            const currentDate = new Date().toLocaleDateString('hi-IN');
            const currentTime = new Date().toLocaleTimeString('hi-IN');
            const total = entries.reduce((sum, entry) => sum + entry.amount, 0);
            
            let printContent = `
                <div style="padding: 20px; font-family: 'Noto Sans Devanagari', sans-serif; max-width: 400px; margin: 0 auto; border: 2px solid #000;">
                    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                        <h2 style="margin: 0; font-size: 24px; font-weight: bold;">${shopName}</h2>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                            <div>‡§¶‡§ø‡§®: ${getDayName()}</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
            `;
            
            entries.forEach((entry, index) => {
                printContent += `
                    <div style="display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <span style="font-weight: bold;">‚Çπ${entry.amount}</span>
                        <span style="flex: 1; margin-left: 15px;">${entry.description}</span>
                    </div>
                `;
            });
            
            printContent += `
                    </div>
                    <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                        <div style="text-align: left;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                            <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${total}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                        <p style="margin: 0; font-size: 16px; font-weight: bold;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                        <p style="margin: 5px 0 0 0; font-size: 14px;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                    </div>
                </div>
            `;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        function saveBill() {
            if (entries.length === 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§õ entries add ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const billData = {
                id: billCounter,
                date: new Date().toISOString(),
                entries: [...entries],
                total: entries.reduce((sum, entry) => sum + entry.amount, 0)
            };

            // Save to localStorage
            let savedBills = JSON.parse(localStorage.getItem('savedBills') || '[]');
            savedBills.unshift(billData);
            
            // Keep only last 50 bills
            if (savedBills.length > 50) {
                savedBills = savedBills.slice(0, 50);
            }
            
            localStorage.setItem('savedBills', JSON.stringify(savedBills));
            
            // Update bill counter
            billCounter++;
            localStorage.setItem('billCounter', billCounter.toString());
            updateBillNumber();

            showSuccess('‚úÖ Bill successfully saved!');
        }

        function shareBill() {
            if (entries.length === 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§õ entries add ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const currentDate = new Date().toLocaleDateString('hi-IN');
            const currentTime = new Date().toLocaleTimeString('hi-IN');
            const total = entries.reduce((sum, entry) => sum + entry.amount, 0);
            
            // Create bill image for sharing
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let imageContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 24px; font-weight: bold; color: #000;">${shopName}</h2>
                    <div style="margin-top: 10px; font-size: 14px; color: #000;">
                        <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                        <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(billCounter).padStart(4, '0')}</div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
            `;
            
            entries.forEach((entry, index) => {
                imageContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold; color: #000;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px; color: #000;">${entry.description}</div>
                    </div>
                `;
            });
            
            imageContent += `
                </div>
                <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                    <div style="text-align: left; color: #000;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                        <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${total}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold; color: #000;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px; color: #000;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                </div>
            `;
            
            tempDiv.innerHTML = imageContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.share) {
                        navigator.share({
                            title: 'Bill Details',
                            files: [new File([blob], `bill_${String(billCounter).padStart(4, '0')}.png`, { type: 'image/png' })]
                        });
                    } else {
                        const link = document.createElement('a');
                        link.download = `bill_${String(billCounter).padStart(4, '0')}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                        showSuccess('üì§ Bill image downloaded!');
                    }
                    document.body.removeChild(tempDiv);
                });
            });
        }

        function downloadImage() {
            if (entries.length === 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§õ entries add ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const currentDate = new Date().toLocaleDateString('hi-IN');
            const currentTime = new Date().toLocaleTimeString('hi-IN');
            const total = entries.reduce((sum, entry) => sum + entry.amount, 0);
            
            // Create a temporary div for image generation
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let imageContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 24px; font-weight: bold; color: #000;">${shopName}</h2>
                    <div style="margin-top: 10px; font-size: 14px; color: #000;">
                        <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                        <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(billCounter).padStart(4, '0')}</div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
            `;
            
            entries.forEach((entry, index) => {
                imageContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold; color: #000;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px; color: #000;">${entry.description}</div>
                    </div>
                `;
            });
            
            imageContent += `
                </div>
                <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                    <div style="text-align: left; color: #000;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                        <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${total}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold; color: #000;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px; color: #000;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                </div>
            `;
            
            tempDiv.innerHTML = imageContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `bill_${String(billCounter).padStart(4, '0')}.png`;
                link.href = canvas.toDataURL();
                link.click();
                document.body.removeChild(tempDiv);
                showSuccess('üì∑ Bill image downloaded!');
            });
        }

        function showHistory() {
            const savedBills = JSON.parse(localStorage.getItem('savedBills') || '[]');
            const historyList = document.getElementById('historyList');
            
            if (savedBills.length === 0) {
                historyList.innerHTML = '<p class="text-gray-500 text-center py-8">‡§ï‡•ã‡§à saved bills ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á</p>';
            } else {
                historyList.innerHTML = '';
                savedBills.forEach(bill => {
                    const billDiv = document.createElement('div');
                    billDiv.className = 'border border-gray-200 rounded-lg p-4 mb-3 hover:bg-gray-50';
                    billDiv.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold cursor-pointer" onclick="viewBillDetails(${JSON.stringify(bill).replace(/"/g, '&quot;')})">Bill #${String(bill.id).padStart(4, '0')}</h4>
                            <span class="text-sm text-gray-500">${new Date(bill.date).toLocaleDateString('hi-IN')}</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-2 cursor-pointer" onclick="viewBillDetails(${JSON.stringify(bill).replace(/"/g, '&quot;')})">${bill.entries.length} entries</div>
                        <div class="flex justify-between items-center">
                            <div class="font-bold text-indigo-600 cursor-pointer" onclick="viewBillDetails(${JSON.stringify(bill).replace(/"/g, '&quot;')})">Total: ‚Çπ${bill.total}</div>
                            <div class="flex gap-1">
                                <button onclick="event.stopPropagation(); printHistoryBill(${JSON.stringify(bill).replace(/"/g, '&quot;')})" class="bg-blue-100 hover:bg-blue-200 p-1.5 rounded-lg transition-colors text-xs" title="Print">
                                    üñ®Ô∏è
                                </button>
                                <button onclick="event.stopPropagation(); shareHistoryBill(${JSON.stringify(bill).replace(/"/g, '&quot;')})" class="bg-green-100 hover:bg-green-200 p-1.5 rounded-lg transition-colors text-xs" title="Share">
                                    üì§
                                </button>
                                <button onclick="event.stopPropagation(); sendHistoryNotice(${JSON.stringify(bill).replace(/"/g, '&quot;')})" class="bg-orange-100 hover:bg-orange-200 p-1.5 rounded-lg transition-colors text-xs" title="Send Notice">
                                    üì¢
                                </button>
                                <button onclick="event.stopPropagation(); deleteHistoryBill(${bill.id})" class="bg-red-100 hover:bg-red-200 p-1.5 rounded-lg transition-colors text-xs" title="Delete">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    `;
                    historyList.appendChild(billDiv);
                });
            }
            
            document.getElementById('historyModal').classList.remove('hidden');
        }

        let currentViewingBill = null;

        function viewBillDetails(billData) {
            currentViewingBill = billData;
            const title = document.getElementById('billDetailsTitle');
            const content = document.getElementById('billDetailsContent');
            
            title.textContent = `Bill #${String(billData.id).padStart(4, '0')} - ${new Date(billData.date).toLocaleDateString('hi-IN')}`;
            
            let detailsHTML = '<div class="space-y-3" id="viewingBillContent">';
            detailsHTML += `
                <div class="text-center mb-6 border-b pb-4">
                    <h2 class="text-3xl font-bold text-gray-800 mb-2">${shopName}</h2>
                    <div class="flex justify-between text-sm text-gray-600">
                        <span>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${new Date(billData.date).toLocaleDateString('hi-IN')}</span>
                        <span>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(billData.id).padStart(4, '0')}</span>
                    </div>
                </div>
            `;
            
            billData.entries.forEach((entry, index) => {
                detailsHTML += `
                    <div class="flex items-center py-2 border-b border-gray-100">
                        <div class="w-24 text-right font-bold"><span class="font-light">‚Çπ</span> ${entry.amount}</div>
                        <div class="flex-1 text-left pl-4">${entry.description}</div>
                    </div>
                `;
            });
            
            detailsHTML += `
                <div class="border-t pt-4 mt-4">
                    <div class="text-left">
                        <div class="text-lg font-semibold text-gray-700 mb-2">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                        <div class="text-2xl font-bold text-indigo-600"><span class="font-light">‚Çπ</span> ${billData.total}</div>
                    </div>
                </div>
            </div>`;
            
            content.innerHTML = detailsHTML;
            
            closeHistory();
            document.getElementById('billDetailsModal').classList.remove('hidden');
        }

        function printBillDetails() {
            if (!currentViewingBill) return;
            
            const originalContent = document.body.innerHTML;
            const currentDate = new Date(currentViewingBill.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(currentViewingBill.date).toLocaleTimeString('hi-IN');
            
            let printContent = `
                <div style="padding: 20px; font-family: 'Noto Sans Devanagari', sans-serif; max-width: 400px; margin: 0 auto; border: 2px solid #000;">
                    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                        <h2 style="margin: 0; font-size: 24px; font-weight: bold;">${shopName}</h2>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                            <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(currentViewingBill.id).padStart(4, '0')}</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
            `;
            
            currentViewingBill.entries.forEach((entry, index) => {
                printContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px;">${entry.description}</div>
                    </div>
                `;
            });
            
            printContent += `
                    </div>
                    <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                        <div style="text-align: left; font-size: 18px; font-weight: bold;">
                            <div>‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ ${currentViewingBill.total}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                        <p style="margin: 0; font-size: 16px; font-weight: bold;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                        <p style="margin: 5px 0 0 0; font-size: 14px;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                    </div>
                </div>
            `;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        function shareBillDetails() {
            if (!currentViewingBill) return;
            
            let shareText = `üìã ${shopName}\n`;
            shareText += `Date: ${new Date(currentViewingBill.date).toLocaleDateString('hi-IN')}\n`;
            shareText += `Day: ${new Date(currentViewingBill.date).toLocaleDateString('hi-IN', {weekday: 'long'})}\n\n`;
            
            currentViewingBill.entries.forEach((entry, index) => {
                shareText += `‚Çπ${entry.amount} - ${entry.description}\n`;
            });
            
            shareText += `\nTotal Amount: ‚Çπ${currentViewingBill.total}\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!`;

            if (navigator.share) {
                navigator.share({
                    title: 'Bill Details',
                    text: shareText
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showSuccess('üìã Bill copied to clipboard!');
                });
            }
        }

        function downloadBillDetailsImage() {
            if (!currentViewingBill) return;
            
            const currentDate = new Date(currentViewingBill.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(currentViewingBill.date).toLocaleTimeString('hi-IN');
            
            // Create a temporary div for image generation
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let imageContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 24px; font-weight: bold; color: #000;">${shopName}</h2>
                    <div style="margin-top: 10px; font-size: 14px; color: #000;">
                        <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                        <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(currentViewingBill.id).padStart(4, '0')}</div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
            `;
            
            currentViewingBill.entries.forEach((entry, index) => {
                imageContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold; color: #000;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px; color: #000;">${entry.description}</div>
                    </div>
                `;
            });
            
            imageContent += `
                </div>
                <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                    <div style="text-align: left; color: #000;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                        <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${currentViewingBill.total}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold; color: #000;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px; color: #000;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                </div>
            `;
            
            tempDiv.innerHTML = imageContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `bill_${String(currentViewingBill.id).padStart(4, '0')}.png`;
                link.href = canvas.toDataURL();
                link.click();
                document.body.removeChild(tempDiv);
                showSuccess('üì∑ Bill image downloaded!');
            });
        }

        function closeBillDetails() {
            document.getElementById('billDetailsModal').classList.add('hidden');
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.add('hidden');
        }

        function showSuccess(message) {
            const successMsg = document.getElementById('successMessage');
            document.getElementById('successText').textContent = message;
            successMsg.classList.remove('hidden');
            setTimeout(() => {
                successMsg.classList.add('hidden');
            }, 1500);
        }

        function sendNotice() {
            if (entries.length === 0) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§ï‡•Å‡§õ entries add ‡§ï‡§∞‡•á‡§Ç!');
                return;
            }

            const total = entries.reduce((sum, entry) => sum + entry.amount, 0);
            const currentDate = new Date().toLocaleDateString('hi-IN');
            const currentTime = new Date().toLocaleTimeString('hi-IN');
            
            // Create notice image
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let noticeContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0; font-size: 28px; font-weight: bold; color: #dc2626;">üì¢ PAYMENT NOTICE</h2>
                </div>
                <div style="margin-bottom: 20px; color: #000;">
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 10px;">${shopName}</div>
                    <div style="font-size: 14px; margin-bottom: 5px;">Date: ${currentDate}</div>
                    <div style="font-size: 14px; margin-bottom: 5px;">Time: ${currentTime}</div>
                    <div style="font-size: 14px; margin-bottom: 15px;">Bill No: ${String(billCounter).padStart(4, '0')}</div>
                    <div style="font-size: 18px; font-weight: bold; color: #dc2626; margin-bottom: 20px;">Total Amount Due: ‚Çπ${total}</div>
                </div>
                <div style="border-top: 2px solid #000; padding-top: 15px; text-align: center; color: #000;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold;">‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                    <p style="margin: 5px 0; font-size: 16px; font-weight: bold;">Please make payment soon.</p>
                    <p style="margin: 15px 0 0 0; font-size: 18px; font-weight: bold;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                </div>
            `;
            
            tempDiv.innerHTML = noticeContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.share) {
                        navigator.share({
                            title: 'Payment Notice',
                            files: [new File([blob], `notice_${String(billCounter).padStart(4, '0')}.png`, { type: 'image/png' })]
                        });
                    } else {
                        const link = document.createElement('a');
                        link.download = `notice_${String(billCounter).padStart(4, '0')}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                        showSuccess('üì¢ Payment notice image downloaded!');
                    }
                    document.body.removeChild(tempDiv);
                });
            });
        }

        function sendNoticeDetails() {
            if (!currentViewingBill) return;
            
            const currentDate = new Date(currentViewingBill.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(currentViewingBill.date).toLocaleTimeString('hi-IN');
            
            let noticeText = `üì¢ PAYMENT NOTICE\n\n`;
            noticeText += `${shopName}\n`;
            noticeText += `Date: ${currentDate}\n`;
            noticeText += `Time: ${currentTime}\n`;
            noticeText += `Bill No: ${String(currentViewingBill.id).padStart(4, '0')}\n\n`;
            noticeText += `Total Amount Due: ‚Çπ${currentViewingBill.total}\n\n`;
            noticeText += `‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§\nPlease make payment soon.\n\n‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!`;

            if (navigator.share) {
                navigator.share({
                    title: 'Payment Notice',
                    text: noticeText
                });
            } else {
                navigator.clipboard.writeText(noticeText).then(() => {
                    showSuccess('üì¢ Payment notice copied to clipboard!');
                });
            }
        }

        function printHistoryBill(billData) {
            const originalContent = document.body.innerHTML;
            const currentDate = new Date(billData.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(billData.date).toLocaleTimeString('hi-IN');
            
            let printContent = `
                <div style="padding: 20px; font-family: 'Noto Sans Devanagari', sans-serif; max-width: 400px; margin: 0 auto; border: 2px solid #000;">
                    <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                        <h2 style="margin: 0; font-size: 24px; font-weight: bold;">${shopName}</h2>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                            <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(billData.id).padStart(4, '0')}</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
            `;
            
            billData.entries.forEach((entry, index) => {
                printContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px;">${entry.description}</div>
                    </div>
                `;
            });
            
            printContent += `
                    </div>
                    <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                        <div style="text-align: left;">
                            <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                            <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${billData.total}</div>
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                        <p style="margin: 0; font-size: 16px; font-weight: bold;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                        <p style="margin: 5px 0 0 0; font-size: 14px;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                    </div>
                </div>
            `;
            
            document.body.innerHTML = printContent;
            window.print();
            document.body.innerHTML = originalContent;
            location.reload();
        }

        function shareHistoryBill(billData) {
            const currentDate = new Date(billData.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(billData.date).toLocaleTimeString('hi-IN');
            
            // Create bill image for sharing
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let imageContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 15px;">
                    <h2 style="margin: 0; font-size: 24px; font-weight: bold; color: #000;">${shopName}</h2>
                    <div style="margin-top: 10px; font-size: 14px; color: #000;">
                        <div>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï: ${currentDate} | ‡§∏‡§Æ‡§Ø: ${currentTime}</div>
                        <div>‡§¨‡§ø‡§≤ ‡§®‡§Ç: ${String(billData.id).padStart(4, '0')}</div>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
            `;
            
            billData.entries.forEach((entry, index) => {
                imageContent += `
                    <div style="display: flex; padding: 5px 0; border-bottom: 1px solid #ccc;">
                        <div style="width: 120px; text-align: right; font-weight: bold; color: #000;"><span style="font-weight: 300;">‚Çπ</span> ${entry.amount}</div>
                        <div style="flex: 1; margin-left: 15px; color: #000;">${entry.description}</div>
                    </div>
                `;
            });
            
            imageContent += `
                </div>
                <div style="border-top: 2px solid #000; padding-top: 10px; margin-top: 15px;">
                    <div style="text-align: left; color: #000;">
                        <div style="font-size: 16px; font-weight: 600; margin-bottom: 5px;">‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø:</div>
                        <div style="font-size: 20px; font-weight: bold;"><span style="font-weight: 300;">‚Çπ</span> ${billData.total}</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #ccc;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold; color: #000;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                    <p style="margin: 5px 0 0 0; font-size: 14px; color: #000;">‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                </div>
            `;
            
            tempDiv.innerHTML = imageContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.share) {
                        navigator.share({
                            title: 'Bill Details',
                            files: [new File([blob], `bill_${String(billData.id).padStart(4, '0')}.png`, { type: 'image/png' })]
                        });
                    } else {
                        const link = document.createElement('a');
                        link.download = `bill_${String(billData.id).padStart(4, '0')}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                        showSuccess('üì§ Bill image downloaded!');
                    }
                    document.body.removeChild(tempDiv);
                });
            });
        }

        function sendHistoryNotice(billData) {
            const currentDate = new Date(billData.date).toLocaleDateString('hi-IN');
            const currentTime = new Date(billData.date).toLocaleTimeString('hi-IN');
            
            // Create notice image
            const tempDiv = document.createElement('div');
            tempDiv.style.cssText = 'position: absolute; left: -9999px; top: -9999px; background: white; padding: 20px; font-family: "Noto Sans Devanagari", sans-serif; max-width: 400px; border: 2px solid #000;';
            
            let noticeContent = `
                <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 15px; margin-bottom: 20px;">
                    <h2 style="margin: 0; font-size: 28px; font-weight: bold; color: #dc2626;">üì¢ PAYMENT NOTICE</h2>
                </div>
                <div style="margin-bottom: 20px; color: #000;">
                    <div style="font-size: 20px; font-weight: bold; margin-bottom: 10px;">${shopName}</div>
                    <div style="font-size: 14px; margin-bottom: 5px;">Date: ${currentDate}</div>
                    <div style="font-size: 14px; margin-bottom: 5px;">Time: ${currentTime}</div>
                    <div style="font-size: 14px; margin-bottom: 15px;">Bill No: ${String(billData.id).padStart(4, '0')}</div>
                    <div style="font-size: 18px; font-weight: bold; color: #dc2626; margin-bottom: 20px;">Total Amount Due: ‚Çπ${billData.total}</div>
                </div>
                <div style="border-top: 2px solid #000; padding-top: 15px; text-align: center; color: #000;">
                    <p style="margin: 0; font-size: 16px; font-weight: bold;">‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§</p>
                    <p style="margin: 5px 0; font-size: 16px; font-weight: bold;">Please make payment soon.</p>
                    <p style="margin: 15px 0 0 0; font-size: 18px; font-weight: bold;">‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!</p>
                </div>
            `;
            
            tempDiv.innerHTML = noticeContent;
            document.body.appendChild(tempDiv);
            
            html2canvas(tempDiv, {
                backgroundColor: '#ffffff',
                scale: 2
            }).then(canvas => {
                canvas.toBlob(blob => {
                    if (navigator.share) {
                        navigator.share({
                            title: 'Payment Notice',
                            files: [new File([blob], `notice_${String(billData.id).padStart(4, '0')}.png`, { type: 'image/png' })]
                        });
                    } else {
                        const link = document.createElement('a');
                        link.download = `notice_${String(billData.id).padStart(4, '0')}.png`;
                        link.href = URL.createObjectURL(blob);
                        link.click();
                        showSuccess('üì¢ Payment notice image downloaded!');
                    }
                    document.body.removeChild(tempDiv);
                });
            });
        }

        function deleteHistoryBill(billId) {
            if (confirm('‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™ ‡§á‡§∏ bill ‡§ï‡•ã delete ‡§ï‡§∞‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?')) {
                let savedBills = JSON.parse(localStorage.getItem('savedBills') || '[]');
                savedBills = savedBills.filter(bill => bill.id !== billId);
                localStorage.setItem('savedBills', JSON.stringify(savedBills));
                showHistory(); // Refresh history
                showSuccess('üóëÔ∏è Bill deleted successfully!');
            }
        }

        // Enter key support
        document.getElementById('amount').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('itemDescription').focus();
            }
        });

        document.getElementById('itemDescription').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addEntry();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96cea75785de84a1',t:'MTc1NDgyMDEwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
